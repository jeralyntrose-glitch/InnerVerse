STAGE 4B: Build Interactive Knowledge Graph Visualization Page

Create a beautiful, interactive 3D knowledge graph visualization that shows how CS Joseph's concepts interconnect.

CRITICAL CONTEXT:
- Total concepts: 1,628 (too many to show at once)
- Concepts with frequency >= 3: 176 (perfect for visualization)
- Default view: Show top 176 concepts, allow users to adjust filter
- InnerVerse purple theme: #7C3AED primary, dark background
- Must be smooth and performant, NOT janky

REQUIREMENTS:

1. INSTALL DEPENDENCIES

   Add to package.json or run:
npm install react-force-graph-3d three
   
   Or if using Python/React hybrid:
npm install --prefix frontend react-force-graph-3d three

2. CREATE VISUALIZATION PAGE COMPONENT
   
   File: /frontend/src/pages/KnowledgeGraph.jsx (or appropriate location)
   
   Structure:
```jsx
   import React, { useState, useEffect, useRef } from 'react';
   import ForceGraph3D from 'react-force-graph-3d';
   import './KnowledgeGraph.css';
   
   export default function KnowledgeGraph() {
     const [graphData, setGraphData] = useState({ nodes: [], links: [] });
     const [stats, setStats] = useState({});
     const [loading, setLoading] = useState(true);
     const [selectedNode, setSelectedNode] = useState(null);
     const [frequencyThreshold, setFrequencyThreshold] = useState(3);
     const [searchTerm, setSearchTerm] = useState('');
     const [categoryFilter, setCategoryFilter] = useState('all');
     const graphRef = useRef();
     
     // ... rest of component
   }
```

3. FETCH GRAPH DATA
```jsx
   useEffect(() => {
     async function loadGraph() {
       try {
         const response = await fetch('/api/knowledge-graph');
         const data = await response.json();
         
         // Transform to react-force-graph format
         const nodes = data.nodes.map(node => ({
           id: node.id,
           label: node.label,
           type: node.type,
           category: node.category,
           definition: node.definition,
           frequency: node.frequency || 1,
           val: node.frequency || 1,  // Node size
           color: getCategoryColor(node.category),
           sourceDocuments: node.source_documents
         }));
         
         const links = data.edges.map(edge => ({
           source: edge.source,
           target: edge.target,
           label: edge.relationship_type,
           strength: edge.strength || 1,
           color: getRelationshipColor(edge.relationship_type)
         }));
         
         setGraphData({ nodes, links });
         setStats(data.metadata || data.stats);
         setLoading(false);
       } catch (error) {
         console.error('Failed to load graph:', error);
         setLoading(false);
       }
     }
     
     loadGraph();
   }, []);
```

4. IMPLEMENT FILTERING
```jsx
   // Filter nodes by frequency threshold
   const filteredData = React.useMemo(() => {
     let nodes = graphData.nodes.filter(node => 
       node.frequency >= frequencyThreshold
     );
     
     // Apply category filter
     if (categoryFilter !== 'all') {
       nodes = nodes.filter(node => node.category === categoryFilter);
     }
     
     // Apply search filter
     if (searchTerm) {
       nodes = nodes.filter(node =>
         node.label.toLowerCase().includes(searchTerm.toLowerCase())
       );
     }
     
     // Only include links where both nodes are visible
     const nodeIds = new Set(nodes.map(n => n.id));
     const links = graphData.links.filter(link =>
       nodeIds.has(link.source.id || link.source) &&
       nodeIds.has(link.target.id || link.target)
     );
     
     return { nodes, links };
   }, [graphData, frequencyThreshold, categoryFilter, searchTerm]);
```

5. COLOR SCHEMES (InnerVerse Purple Theme)
```jsx
   function getCategoryColor(category) {
     const colors = {
       foundational: '#7C3AED',    // Purple (primary)
       intermediate: '#A78BFA',     // Light purple
       advanced: '#EC4899',         // Pink
       uncategorized: '#6B7280'     // Gray
     };
     return colors[category] || colors.uncategorized;
   }
   
   function getRelationshipColor(type) {
     const colors = {
       requires_understanding: '#7C3AED',
       leads_to: '#10B981',
       contrasts_with: '#EF4444',
       builds_on: '#3B82F6',
       enables: '#F59E0B',
       manifests_as: '#8B5CF6',
       part_of: '#6366F1',
       related_to: '#6B7280'
     };
     return colors[type] || colors.related_to;
   }
```

6. BUILD UI LAYOUT
```jsx
   return (
     <div className="knowledge-graph-page">
       {/* Header */}
       <header className="kg-header">
         <div className="kg-title">
           <h1>üåê Knowledge Graph</h1>
           <p>Explore the connections in CS Joseph's teachings</p>
         </div>
         
         <div className="kg-stats">
           <div className="stat">
             <span className="stat-value">{filteredData.nodes.length}</span>
             <span className="stat-label">Concepts</span>
           </div>
           <div className="stat">
             <span className="stat-value">{filteredData.links.length}</span>
             <span className="stat-label">Connections</span>
           </div>
           <div className="stat">
             <span className="stat-value">{stats.total_documents_processed || 0}</span>
             <span className="stat-label">Documents</span>
           </div>
         </div>
       </header>
       
       {/* Controls */}
       <div className="kg-controls">
         <div className="control-group">
           <label>Minimum Frequency</label>
           <input
             type="range"
             min="1"
             max="20"
             value={frequencyThreshold}
             onChange={(e) => setFrequencyThreshold(Number(e.target.value))}
           />
           <span className="threshold-value">‚â• {frequencyThreshold}</span>
         </div>
         
         <div className="control-group">
           <label>Category</label>
           <select value={categoryFilter} onChange={(e) => setCategoryFilter(e.target.value)}>
             <option value="all">All Categories</option>
             <option value="foundational">Foundational</option>
             <option value="intermediate">Intermediate</option>
             <option value="advanced">Advanced</option>
           </select>
         </div>
         
         <div className="control-group">
           <label>Search</label>
           <input
             type="text"
             placeholder="Search concepts..."
             value={searchTerm}
             onChange={(e) => setSearchTerm(e.target.value)}
           />
         </div>
         
         <button 
           className="reset-btn"
           onClick={() => {
             setFrequencyThreshold(3);
             setCategoryFilter('all');
             setSearchTerm('');
           }}
         >
           Reset Filters
         </button>
       </div>
       
       {/* Graph Container */}
       <div className="kg-graph-container">
         {loading ? (
           <div className="loading">
             <div className="spinner"></div>
             <p>Loading knowledge graph...</p>
           </div>
         ) : (
           <ForceGraph3D
             ref={graphRef}
             graphData={filteredData}
             nodeLabel="label"
             nodeAutoColorBy="category"
             nodeVal="val"
             linkLabel="label"
             linkWidth={link => link.strength || 1}
             linkDirectionalParticles={2}
             linkDirectionalParticleWidth={2}
             onNodeClick={handleNodeClick}
             onNodeHover={handleNodeHover}
             backgroundColor="#0F172A"
             width={window.innerWidth - 40}
             height={window.innerHeight - 300}
           />
         )}
       </div>
       
       {/* Node Details Panel */}
       {selectedNode && (
         <div className="node-details-panel">
           <button className="close-btn" onClick={() => setSelectedNode(null)}>√ó</button>
           
           <h3>{selectedNode.label}</h3>
           
           <div className="node-meta">
             <span className="badge">{selectedNode.type}</span>
             <span className="badge">{selectedNode.category}</span>
             <span className="badge">Frequency: {selectedNode.frequency}</span>
           </div>
           
           <p className="node-definition">{selectedNode.definition}</p>
           
           <div className="node-connections">
             <h4>Connected Concepts ({selectedNode.neighbors?.length || 0})</h4>
             <ul>
               {selectedNode.neighbors?.slice(0, 10).map((neighbor, i) => (
                 <li key={i}>{neighbor.relationship} ‚Üí {neighbor.label}</li>
               ))}
             </ul>
           </div>
           
           <div className="node-sources">
             <h4>Appears in {selectedNode.sourceDocuments?.length || 0} documents</h4>
             <button onClick={() => viewSourceDocs(selectedNode)}>
               View Source Documents
             </button>
           </div>
         </div>
       )}
     </div>
   );
```

7. INTERACTION HANDLERS
```jsx
   function handleNodeClick(node) {
     // Find connected nodes
     const neighbors = graphData.links
       .filter(link => 
         (link.source.id || link.source) === node.id ||
         (link.target.id || link.target) === node.id
       )
       .map(link => {
         const isSource = (link.source.id || link.source) === node.id;
         const neighborId = isSource ? (link.target.id || link.target) : (link.source.id || link.source);
         const neighbor = graphData.nodes.find(n => n.id === neighborId);
         return {
           label: neighbor?.label,
           relationship: link.label
         };
       });
     
     setSelectedNode({
       ...node,
       neighbors
     });
   }
   
   function handleNodeHover(node) {
     // Highlight connected nodes
     if (node) {
       const connectedIds = new Set(
         graphData.links
           .filter(link =>
             (link.source.id || link.source) === node.id ||
             (link.target.id || link.target) === node.id
           )
           .flatMap(link => [
             link.source.id || link.source,
             link.target.id || link.target
           ])
       );
       
       // Update node/link highlighting (implementation depends on library capabilities)
     }
   }
   
   function viewSourceDocs(node) {
     // Navigate to Content Atlas filtered by this node's documents
     const docIds = node.sourceDocuments?.join(',');
     window.location.href = `/content-atlas?documents=${docIds}`;
   }
```

8. STYLING (InnerVerse Theme)
   
   File: /frontend/src/pages/KnowledgeGraph.css
```css
   .knowledge-graph-page {
     min-height: 100vh;
     background: #0F172A;
     color: #F8FAFC;
     padding: 20px;
   }
   
   .kg-header {
     display: flex;
     justify-content: space-between;
     align-items: center;
     margin-bottom: 30px;
     padding: 20px;
     background: #1E293B;
     border-radius: 12px;
   }
   
   .kg-title h1 {
     font-size: 32px;
     font-weight: 600;
     margin: 0 0 8px 0;
     background: linear-gradient(135deg, #7C3AED 0%, #EC4899 100%);
     -webkit-background-clip: text;
     -webkit-text-fill-color: transparent;
   }
   
   .kg-title p {
     color: #94A3B8;
     margin: 0;
   }
   
   .kg-stats {
     display: flex;
     gap: 30px;
   }
   
   .stat {
     display: flex;
     flex-direction: column;
     align-items: center;
   }
   
   .stat-value {
     font-size: 28px;
     font-weight: 700;
     color: #7C3AED;
   }
   
   .stat-label {
     font-size: 14px;
     color: #94A3B8;
     text-transform: uppercase;
     letter-spacing: 0.05em;
   }
   
   .kg-controls {
     display: flex;
     gap: 20px;
     margin-bottom: 20px;
     padding: 20px;
     background: #1E293B;
     border-radius: 12px;
     flex-wrap: wrap;
   }
   
   .control-group {
     display: flex;
     flex-direction: column;
     gap: 8px;
     flex: 1;
     min-width: 200px;
   }
   
   .control-group label {
     font-size: 14px;
     font-weight: 500;
     color: #CBD5E1;
   }
   
   .control-group input[type="range"] {
     width: 100%;
     accent-color: #7C3AED;
   }
   
   .control-group input[type="text"],
   .control-group select {
     padding: 10px;
     background: #0F172A;
     border: 1px solid #334155;
     border-radius: 8px;
     color: #F8FAFC;
     font-size: 14px;
   }
   
   .control-group input[type="text"]:focus,
   .control-group select:focus {
     outline: none;
     border-color: #7C3AED;
   }
   
   .threshold-value {
     color: #7C3AED;
     font-weight: 600;
     font-size: 16px;
   }
   
   .reset-btn {
     padding: 10px 20px;
     background: #7C3AED;
     color: white;
     border: none;
     border-radius: 8px;
     cursor: pointer;
     font-weight: 500;
     align-self: flex-end;
   }
   
   .reset-btn:hover {
     background: #6D28D9;
   }
   
   .kg-graph-container {
     background: #1E293B;
     border-radius: 12px;
     overflow: hidden;
     position: relative;
   }
   
   .loading {
     display: flex;
     flex-direction: column;
     align-items: center;
     justify-content: center;
     height: 600px;
     color: #94A3B8;
   }
   
   .spinner {
     width: 50px;
     height: 50px;
     border: 4px solid #334155;
     border-top-color: #7C3AED;
     border-radius: 50%;
     animation: spin 1s linear infinite;
   }
   
   @keyframes spin {
     to { transform: rotate(360deg); }
   }
   
   .node-details-panel {
     position: fixed;
     right: 20px;
     top: 50%;
     transform: translateY(-50%);
     width: 350px;
     max-height: 80vh;
     overflow-y: auto;
     background: #1E293B;
     border: 1px solid #334155;
     border-radius: 12px;
     padding: 20px;
     box-shadow: 0 10px 40px rgba(0,0,0,0.5);
   }
   
   .close-btn {
     position: absolute;
     top: 10px;
     right: 10px;
     background: none;
     border: none;
     color: #94A3B8;
     font-size: 24px;
     cursor: pointer;
     padding: 5px 10px;
   }
   
   .close-btn:hover {
     color: #F8FAFC;
   }
   
   .node-details-panel h3 {
     margin: 0 0 15px 0;
     color: #7C3AED;
     font-size: 22px;
   }
   
   .node-meta {
     display: flex;
     gap: 8px;
     margin-bottom: 15px;
     flex-wrap: wrap;
   }
   
   .badge {
     padding: 4px 12px;
     background: #0F172A;
     border-radius: 6px;
     font-size: 12px;
     color: #A78BFA;
   }
   
   .node-definition {
     color: #CBD5E1;
     line-height: 1.6;
     margin-bottom: 20px;
   }
   
   .node-connections,
   .node-sources {
     margin-top: 20px;
   }
   
   .node-connections h4,
   .node-sources h4 {
     font-size: 16px;
     margin-bottom: 10px;
     color: #F8FAFC;
   }
   
   .node-connections ul {
     list-style: none;
     padding: 0;
     margin: 0;
   }
   
   .node-connections li {
     padding: 8px;
     background: #0F172A;
     margin-bottom: 6px;
     border-radius: 6px;
     font-size: 14px;
     color: #CBD5E1;
   }
   
   .node-sources button {
     width: 100%;
     padding: 10px;
     background: #7C3AED;
     color: white;
     border: none;
     border-radius: 8px;
     cursor: pointer;
     font-weight: 500;
     margin-top: 10px;
   }
   
   .node-sources button:hover {
     background: #6D28D9;
   }
   
   /* Responsive */
   @media (max-width: 768px) {
     .kg-header {
       flex-direction: column;
       gap: 20px;
     }
     
     .kg-stats {
       width: 100%;
       justify-content: space-around;
     }
     
     .kg-controls {
       flex-direction: column;
     }
     
     .node-details-panel {
       width: calc(100% - 40px);
       right: 20px;
       left: 20px;
       max-height: 50vh;
     }
   }
```

9. ADD NAVIGATION LINK
   
   Update your main navigation to include:
```jsx
   <NavLink to="/knowledge-graph">
     <span className="icon">üåê</span>
     Knowledge Graph
   </NavLink>
```

10. ADD ROUTING
    
    Update your router (wherever routes are defined):
```jsx
    import KnowledgeGraph from './pages/KnowledgeGraph';
    
    // In routes:
    <Route path="/knowledge-graph" element={<KnowledgeGraph />} />
```

11. PERFORMANCE OPTIMIZATIONS
    
    - Limit initial render to 176 nodes (freq >= 3)
    - Debounce search input (300ms delay)
    - Memoize filtered data
    - Use React.memo for heavy components
    - Consider 2D fallback on mobile

12. MOBILE CONSIDERATIONS
    
    For mobile, optionally switch to 2D:
```jsx
    import ForceGraph2D from 'react-force-graph-2d';  // Also install this
    
    const isMobile = window.innerWidth < 768;
    const GraphComponent = isMobile ? ForceGraph2D : ForceGraph3D;
```

VERIFICATION STEPS:
- Navigate to /knowledge-graph
- Page loads without errors
- Shows 176 concepts by default (freq >= 3)
- Graph renders in 3D
- Can drag, zoom, rotate
- Frequency slider works
- Category filter works
- Search works
- Click node ‚Üí details panel appears
- Node colors match categories
- Links have directional particles
- Performance is smooth (60fps)
- Mobile responsive

DO NOT:
- Show all 1,628 nodes at once (too slow)
- Use default colors (ugly)
- Forget to filter links when filtering nodes
- Block the UI thread
- Break existing navigation

