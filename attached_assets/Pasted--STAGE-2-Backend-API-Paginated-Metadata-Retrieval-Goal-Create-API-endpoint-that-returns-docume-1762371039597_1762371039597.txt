ðŸŽ¯ STAGE 2: Backend API - Paginated Metadata Retrieval
Goal: Create API endpoint that returns documents with full structured metadata, paginated.
Instructions for Replit Agent:
STAGE 2: Content Atlas - Backend API Endpoint

Create a new API endpoint for retrieving documents with complete metadata.

REQUIREMENTS:
1. Create new file: /api/content-atlas.js (or .ts if using TypeScript)

2. Endpoint specifications:
   - Route: GET /api/content-atlas
   - Query parameters:
     * page (number, default: 1)
     * limit (number, default: 50, max: 100)
     * search (string, optional)
   
3. Response format:
   {
     "documents": [
       {
         "id": "doc_id",
         "title": "document title",
         "metadata": {
           "content_type": "lecture",
           "difficulty": "advanced",
           "primary_category": "type_analysis",
           "types_discussed": ["ENFP", "ISTJ"],
           "functions_covered": ["Ne", "Si", "Fi", "Te"],
           "relationship_type": "n/a",
           "quadra": "NF",
           "temple": "soul",
           "topics": ["shadow", "integration"],
           "use_case": ["personal_growth"]
         },
         "upload_date": "2025-11-03"
       }
     ],
     "pagination": {
       "page": 1,
       "limit": 50,
       "total_documents": 340,
       "total_pages": 7,
       "has_next": true,
       "has_previous": false
     }
   }

4. Pinecone query logic:
   - Use namespace from existing system
   - Query for all vectors (or use list/scan if available)
   - Extract full metadata (all 10 fields)
   - Sort by upload_date DESC (most recent first)
   - Apply pagination calculations
   
5. Search functionality (if search param provided):
   - Match against document title
   - Match against metadata.topics array
   - Match against metadata.types_discussed array
   - Case-insensitive matching

6. Error handling:
   - Catch Pinecone errors
   - Return 500 with error message if Pinecone fails
   - Return 400 if invalid parameters
   - Log errors to console for debugging

7. DO NOT:
   - Modify existing upload/query endpoints
   - Change Pinecone index configuration
   - Touch frontend yet

VERIFICATION STEPS:
Test endpoint manually:
- curl http://localhost:3000/api/content-atlas?page=1&limit=10
- Verify response structure matches spec
- Check pagination math is correct
- Test with search parameter
- Check error handling with invalid params
What Could Go Wrong:

Pinecone timeout with large result sets
Metadata fields missing on older documents
Pagination math errors (off-by-one)
Memory issues loading too many vectors at once
Search matching too broad or too narrow

Success Criteria:
âœ… Endpoint returns 200 status
âœ… Documents have all 10 metadata fields
âœ… Pagination math correct (test multiple pages)
âœ… Search parameter filters results
âœ… Handles errors gracefully
STOP HERE. Test with Postman/curl. Report results before Stage 3.